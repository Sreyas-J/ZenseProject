{% extends 'layout.html' %} 

{% load static %}

{% block title %} Home {% endblock %} 

{% block content %} 

<main>
    <section id="form-container">
<img src="{% static 'images/icon.png' %}" id="logo"/>
<div id="welcome-message">
    <h1>Welcome to</h1><b>{{room}}</b>
    <p>Group video calling app</p>
</div>

<form id="form">
    <div class="form-field">
        <input type="submit" value="Join Stream"/>
    </div>
</form>
</section>
</main>

<script type="text/javascript">
    let form = document.getElementById('form');
let welcomeMessage = document.getElementById('welcome-message'); // Select the welcome-message element

let handleSubmit = async (e) => {
    e.preventDefault();
    
    let room = welcomeMessage.querySelector('b').textContent;
    let response = await fetch(`get_token/?channel=${room}`);
    let data = await response.json();
    let UID = data.uid;
    let token = data.token;
    sessionStorage.setItem('UID', UID);
    sessionStorage.setItem('token', token);
    sessionStorage.setItem('room', room);
    window.open(`/room/${room}/`, '_self');
};
form.addEventListener('submit', handleSubmit);

</script>

{% endblock content %}